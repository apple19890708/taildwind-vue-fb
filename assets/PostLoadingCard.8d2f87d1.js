import{_ as X,o as c,c as v,a as e,r as h,l as T,m as O,p as G,n as x,F as L,d as J,t as _,q as $,e as m,s as Y,x as Z,y as ee,z,k as se,f as te,u as o,j as P,I as Q,w as le,v as ae,A as oe,B as ne,C as re}from"./index.709cefc9.js";import{d as V,_ as A}from"./UserInfo.38230ee5.js";import{a as ie,c as ce,p as ue}from"./apiPost.01cd23ee.js";const de={},me={class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",stroke:"white","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},ve=e("path",{d:"M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"},null,-1),pe=[ve];function he(p,b){return c(),v("svg",me,pe)}var ge=X(de,[["render",he]]);const _e={class:"overflow-hidden rounded-lg border-2 border-black"},be=["onClick"],fe=["src"],we={key:0,class:"absolute top-0 left-0 flex h-full w-full items-center justify-center bg-black bg-opacity-40"},ke={class:"text-3xl text-white"},xe={props:{images:{type:Array,default(){return[]}}},setup(p){const b=p,g=h(!1),f=h(0),s=h(T(b.images).map(u=>u.url));O(b,u=>{s.value=T(u.images).map(t=>t.url)});const y=u=>{f.value=u,g.value=!0},w=()=>{g.value=!1};return(u,t)=>{const C=G("vue-easy-lightbox");return c(),v(L,null,[e("div",_e,[e("div",{class:x(["grid gap-0",{"grid-cols-1":p.images.length<=2,"grid-cols-2":p.images.length==3,"grid-cols-3":p.images.length==4,"max-h-96 grid-flow-col grid-rows-6":p.images.length>=5}])},[(c(!0),v(L,null,J(s.value,(j,d)=>(c(),v(L,{key:d},[d<5?(c(),v("div",{key:0,onClick:I=>y(d),class:x(["cursor-pointer",{"col-span-2":s.value.length==3&&d==0,"col-span-3":s.value.length==4&&d==0,"row-span-3":s.value.length>=5&&d<2,"row-span-2":s.value.length>=5&&d>=2,relative:s.value.length>5&&d==4}])},[e("img",{src:j,class:x(["object-center",{"max-h-full":s.value.length==1,"max-h-48":s.value.length==2||s.value.length==3||s.value.length==4}])},null,10,fe),s.value.length>5&&d==4?(c(),v("div",we,[e("span",ke,_(`+ ${s.value.length-5}`),1)])):$("",!0)],10,be)):$("",!0)],64))),128))],2)]),m(C,{visible:g.value,imgs:s.value,index:f.value,onHide:w},null,8,["visible","imgs","index"])],64)}}},ye={class:"rounded-lg border-2 border-black bg-white p-6 shadow-post"},$e={class:"flex items-center gap-x-2"},Ce={class:"text-sm text-subtitle"},Ue={class:"mb-4 whitespace-pre-wrap"},Le=["disabled"],Te={class:"flex w-full max-w-[89%] border-2 border-black"},Ae=["disabled"],je=e("span",null,"\u7559\u8A00",-1),Ie={key:1},Pe={class:"mb-4 rounded-lg bg-secondary p-4"},Ve={class:"whitespace-pre"},ze={class:"whitespace-pre"},Ee={props:{post:{type:Object,default:()=>({})}},setup(p){const b=p,g=Y(),f=Z(),s=h(!1),y=h(!0),w=h(""),u=h(!1),t=h(T(b.post));O(b,l=>{t.value=T(l.post)});const C=h(t.value.comments),j=async l=>{if(s.value=!0,t.value.likes.includes(l))try{const i=await ce(l);d(f.user.id),s.value=!1}catch(i){console.log("error",i),s.value=!1}else try{const i=await ie(l);d(f.user.id),s.value=!1}catch(i){console.log("error",i),s.value=!1}},d=l=>{if(t.value.likes.includes(l)){const i=t.value.likes.findIndex(k=>k===l);t.value.likes.splice(i,1)}else t.value.likes.push(l)},I=async l=>{if(w.value.trim()===""){g.error("\u60A8\u5C1A\u672A\u8F38\u5165\u4EFB\u4F55\u8A0A\u606F");return}u.value=!0;try{const a={comment:w.value},i=await ue(l,a);i.status==="success"&&(W(i.data.comments),g.success("\u65B0\u589E\u7559\u8A00\u6210\u529F"),w.value="",u.value=!1)}catch(a){console.log("error",a),g.error("\u7559\u8A00\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66"),u.value=!1}},W=l=>{const a={comment:l.comment,createdAt:l.createdAt,user:{_id:l.user._id,name:l.user.name,photo:l.user.photo,createdAt:l.createdAt}};C.value.push(a)},r=ee(()=>C.value.sort((a,i)=>{const k=new Date(a.createdAt),U=new Date(i.createdAt);return k-U}));return(l,a)=>{var k,U,B,S,D,H,M,N,F,R,K,q,E;const i=G("RouterLink");return c(),v("div",ye,[e("div",$e,[m(z,{size:"40",imgUrl:(k=t.value.user)==null?void 0:k.photo},null,8,["imgUrl"]),e("div",null,[m(i,{to:`/profile/${(U=t.value.user)==null?void 0:U._id}`,class:"font-bold hover:text-primary hover:underline"},{default:se(()=>{var n;return[te(_((n=t.value.user)==null?void 0:n.name),1)]}),_:1},8,["to"]),e("p",Ce,_(o(V)(t.value.createdAt)),1)])]),e("p",Ue,_(t.value.content),1),((B=t.value.image)==null?void 0:B.length)>0?(c(),P(xe,{key:0,images:t.value.image},null,8,["images"])):$("",!0),e("div",null,[e("button",{type:"button",class:x(["flex items-center justify-center py-5",{"cursor-not-allowed":s.value}]),onClick:a[0]||(a[0]=n=>j(t.value._id)),disabled:s.value},[(S=t.value.likes)!=null&&S.includes(o(f).user.id)?(c(),P(ge,{key:1,class:"mr-2 h-5 w-5 text-primary"})):(c(),P(Q,{key:0,class:"mr-2 h-5 w-5 text-primary"})),e("span",null,_((D=t.value.likes)==null?void 0:D.length),1)],10,Le)]),e("div",{class:"mb-5 flex items-center",onKeyup:a[3]||(a[3]=ne(re(n=>I(t.value._id),["exact"]),["enter"]))},[m(z,{class:"mx-2",size:"40",imgUrl:o(f).user.avatar},null,8,["imgUrl"]),e("div",Te,[le(e("input",{"onUpdate:modelValue":a[1]||(a[1]=n=>w.value=n),class:"w-full border-none focus:ring-2 focus:ring-primary",type:"text"},null,512),[[ae,w.value]]),e("button",{class:x(["flex w-full max-w-[128px] items-center justify-center border-l-2 border-black bg-primary text-base text-white",{"cursor-not-allowed bg-slate-500":u.value}]),onClick:a[2]||(a[2]=n=>I(t.value._id)),disabled:u.value},[je,m(oe,{class:x(["ml-1 h-4 w-4 animate-spin",{hidden:!u.value}])},null,8,["class"])],10,Ae)])],32),o(r).length>1&&y.value?(c(),v("div",Ie,[e("div",{class:"cursor-pointer",onClick:a[4]||(a[4]=n=>y.value=!1)},"\u986F\u793A"+_(o(r).length-1)+"\u5247\u8F03\u65E9\u7559\u8A00",1),e("div",Pe,[m(A,{class:"mb-4",imgUrl:(M=(H=o(r)[o(r).length-1])==null?void 0:H.user)==null?void 0:M.photo,name:(F=(N=o(r)[o(r).length-1])==null?void 0:N.user)==null?void 0:F.name,userPageUrl:`/profile/${(K=(R=o(r)[o(r).length-1])==null?void 0:R.user)==null?void 0:K._id}`,subTitle:o(V)((q=o(r)[o(r).length-1])==null?void 0:q.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),e("p",Ve,_((E=o(r)[o(r).length-1])==null?void 0:E.comment),1)])])):$("",!0),!y.value||o(r).length===1?(c(!0),v(L,{key:2},J(o(r),n=>(c(),v("div",{class:"mb-4 rounded-lg bg-secondary p-4",key:n._id},[m(A,{class:"mb-4",imgUrl:n.user.photo,name:n.user.name,userPageUrl:`/profile/${n.user._id}`,subTitle:o(V)(n.createdAt)},null,8,["imgUrl","name","userPageUrl","subTitle"]),e("p",ze,_(n.comment),1)]))),128)):$("",!0)])}}},Be={class:"animate-pulse rounded-lg border-2 border-black bg-white p-6 shadow-post"},Se=e("p",{class:"mb-4 h-10 whitespace-pre"},"Loading...",-1),De={type:"button",class:"flex items-center justify-center py-5"},He={class:"mb-5 flex items-center"},Me=e("div",{class:"flex w-full max-w-[89%] border-2 border-black"},[e("input",{class:"w-full border-none focus:ring-2 focus:ring-primary",type:"text"}),e("button",{class:"flex w-full max-w-[128px] items-center justify-center border-l-2 border-black bg-primary text-base text-white"}," \u7559\u8A00 ")],-1),Ne={class:"mb-4 rounded-lg bg-secondary px-4 py-5"},Fe=e("p",{class:"mb-4 whitespace-pre"},null,-1),Oe={setup(p){return(b,g)=>(c(),v("div",Be,[m(A,{class:"mb-4",subTitle:"loading..."}),Se,e("div",null,[e("button",De,[m(Q,{class:"mr-2 h-5 w-5"})])]),e("div",He,[m(z,{class:"mx-2",size:"40"}),Me]),e("div",Ne,[m(A,{class:"mb-4",userPageUrl:"#"}),Fe])]))}};export{Oe as _,Ee as a};
