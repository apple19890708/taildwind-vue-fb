import{T as O,o as r,c as d,b as l,z as y,u,k as b,t as f,q as U,a as k,r as $,U as g,h as j,V as q,f as C,w as _,v as x,C as T,F as L,d as G,g as V}from"./index.527efbc1.js";import{_ as z}from"./CardTitle.b80bfa04.js";import{u as D,a as I}from"./useChat.afdbcfc4.js";const N={class:"flex items-center"},S={class:"flex-1 pl-3"},F={key:0,class:"font-bold"},A={key:1,class:"font-bold"},E={class:"w-[200px] overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-slate-500 md:w-80"},M={class:"text-gray text-xs"},B={props:{room:{type:Object,required:!0,default:()=>({})},isGroup:{type:Boolean,default:!1}},setup(w){const t=w,{handleRoom:c}=D(),{name:i,message:o,avatar:m}=O(t.room),v=p=>p?new Date(p).toLocaleString():"\u5C1A\u672A\u958B\u59CB\u5C0D\u8A71",h=()=>{t.isGroup?(console.log("isGroup"),c(t.room,t.isGroup)):(console.log("single"),c(t.room))};return(p,a)=>{var s,e,n,R;return r(),d("li",{onClick:h,class:"shadow-normal mb-4 flex h-[77px] cursor-pointer items-center justify-between rounded-lg border-2 border-black bg-white px-4"},[l("div",N,[t.isGroup?(r(),y(b,{key:1,size:"40",imgUrl:t.room.message[0].sender.photo},null,8,["imgUrl"])):(r(),y(b,{key:0,size:"40",imgUrl:u(m)},null,8,["imgUrl"])),l("div",S,[t.isGroup?(r(),d("p",A,f(t.room.message[0].sender.name),1)):(r(),d("p",F,f(u(i)),1)),l("p",E,f((e=(s=u(o))==null?void 0:s[0])==null?void 0:e.message),1)])]),l("span",M,f(v((R=(n=u(o))==null?void 0:n[0])==null?void 0:R.createdAt)),1)])}}},H={class:"flex items-center justify-center pt-8"},J=V(" \u8F09\u5165\u4E2D "),K={class:"text-center"},X={setup(w){const t=U(),c=k([]),i=k([]),o=$(!0),m=({roomId:a,msg:s})=>{console.log("msg",s);const e=c.findIndex(n=>n.roomId===a);e>-1&&(c[e].message=[s])};g.on("updateChatRecord",m);const v=async()=>{var a;try{o.value=!0;const s=await I.record(),{data:{status:e,chatRecord:n}}=s;e&&(Object.assign(c,n),console.log("chatList",c))}catch(s){const e=(a=s.response.data)==null?void 0:a.message;e&&t.error(e)}finally{o.value=!1}},h=({roomId:a,msg:s})=>{console.log("msg",s);const e=i.findIndex(n=>n.roomId===a);e>-1&&(i[e].message=[s])};g.on("updateOpenChatRecord",h);const p=async()=>{var a;try{o.value=!0;const s=await I.openRecord(),{data:{status:e,chatRecord:n}}=s;e&&(Object.assign(i,n),console.log("chatGroupList",i))}catch(s){const e=(a=s.response.data)==null?void 0:a.message;e&&t.error(e)}finally{o.value=!1}};return j(()=>{v(),p()}),q(()=>{g.off("updateChatRecord",m),g.off("updateOpenChatRecord",h)}),(a,s)=>(r(),d("section",null,[C(z,{title:"\u804A\u5929\u5BA4"}),l("ul",null,[_(l("li",H,[J,C(T,{class:"ml-1 h-4 w-4 animate-spin"})],512),[[x,o.value]]),_(l("h2",null,"\u79C1\u4EBA\u804A\u5929\u5BA4",512),[[x,!o.value]]),_(l("div",K," \u7121\u804A\u5929\u8A18\u9304 ",512),[[x,!o.value&&u(c).length===0]]),(r(!0),d(L,null,G(u(c),e=>(r(),y(B,{key:e==null?void 0:e.roomId,room:e},null,8,["room"]))),128)),_(l("h2",null,"\u516C\u958B\u7FA4\u7D44\u804A\u5929\u5BA4",512),[[x,!o.value]]),(r(!0),d(L,null,G(u(i),e=>(r(),y(B,{key:e==null?void 0:e.roomId,room:e,isGroup:!0},null,8,["room"]))),128))])]))}};export{X as default};
