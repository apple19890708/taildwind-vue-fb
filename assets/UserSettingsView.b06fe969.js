var O=Object.defineProperty;var q=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var V=(b,o,t)=>o in b?O(b,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):b[o]=t,M=(b,o)=>{for(var t in o||(o={}))Q.call(o,t)&&V(b,t,o[t]);if(q)for(var t of q(o))W.call(o,t)&&V(b,t,o[t]);return b};import{s as ee,x as se,r as v,b as U,y as E,m as re,c as f,e as z,a as r,n as L,C as _,F as j,u as s,j as T,z as D,w as p,h as x,t as k,q as $,v as S,A as R,X as ae,Y as te,o as m}from"./index.10b61a3e.js";import{_ as oe}from"./CardTitle.bdca98d3.js";import{u as Z,c as w,r as C,m as le,a as ne,s as ie}from"./index.esm.19341e39.js";const de={class:"flex flex-wrap pl-6 text-center text-sm font-medium"},ce={class:"flex flex-col items-center rounded-xl border-2 border-black bg-white p-8 shadow-post"},ue=["value"],me={key:0,class:"mb-4 text-alert"},be=["onSubmit"],pe={class:"mb-1"},we=r("label",{for:"nickName",class:"mb-1 block"},"\u66B1\u7A31",-1),fe={key:0,class:"font-azeret text-alert"},ge={type:"submit",class:"flex w-full items-center justify-center rounded border-2 border-black bg-warning py-4 text-black disabled:opacity-50"},he=["onSubmit"],ve={class:"mb-1"},ke=r("label",{for:"newPassword",class:"mb-1 block"},"\u8F38\u5165\u65B0\u5BC6\u78BC",-1),xe={key:0,class:"font-azeret text-alert"},ye={class:"mb-1"},Pe=r("label",{for:"checkPassword",class:"mb-1 block"},"\u518D\u6B21\u8F38\u5165",-1),_e={key:1,class:"font-azeret text-alert"},$e=["disabled"],Se={setup(b){const o=ee(),t=se(),c=v(!1),g=U({profile:"\u9001\u51FA\u66F4\u65B0",password:"\u91CD\u8A2D\u5BC6\u78BC"}),u=U({}),A=v(null),X=async l=>{c.value=!0;try{(await ae(u)).status&&(c.value=!1,g.password="\u66F4\u65B0\u5B8C\u6210",u.password="",u.confirmPassword="",B())}catch{c.value=!1,g.password="\u66F4\u65B0\u5931\u6557",B()}l.target.reset(),A.value.click()},B=()=>{setTimeout(()=>{g.profile="\u9001\u51FA\u66F4\u65B0",g.password="\u91CD\u8A2D\u5BC6\u78BC"},3e3)},Y=E(()=>({name:{required:w.withMessage("\u66B1\u7A31\u5FC5\u586B",C),minLength:w.withMessage("\u66B1\u7A31\u81F3\u5C11 2 \u500B\u5B57\u5143\u4EE5\u4E0A",le(2)),maxLength:w.withMessage("\u66B1\u7A31\u4E0D\u80FD\u9AD8\u65BC 10 \u500B\u5B57\u5143",ne(10))}})),G=E(()=>({password:{required:w.withMessage("\u5BC6\u78BC\u5FC5\u586B",C),alphaNum:w.withMessage("\u5BC6\u78BC\u9700\u81F3\u5C11 8 \u78BC\u4EE5\u4E0A\uFF0C\u4E26\u82F1\u6578\u6DF7\u5408",w.regex(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,/\d/))},confirmPassword:{required:w.withMessage("\u5BC6\u78BC\u5FC5\u586B",C),sameAsPassword:w.withMessage("\u5BC6\u78BC\u4E0D\u4E00\u81F4",ie(u.password))}})),y=v("editNickName"),F=l=>{y.value=l},h=v(M({},t.user));re(t,l=>{h.value=M({},l.user)});const P=Z(Y,h),i=Z(G,u),N=v(null),I=v(null),d=U({base64:"",errorMessage:{size:"\u6A94\u6848\u9700\u5728 2 MB \u4EE5\u5167"},hasError:!1}),H=l=>{const e=l.target.files[0];if(e.size>=2*1024*1024)return d.hasError=!0;const n=new FileReader;n.readAsDataURL(e),n.onload=a=>{d.hasError=!1,d.base64=a.target.result}},J=()=>{I.value.reset(),d.base64="",d.hasError=!1},K=async()=>{try{const l=N.value.files[0],e=new FormData;c.value=!0,e.append("photo",l),e.append("name",h.value.name.trim());const n=await te(e);if(console.log("res",n),n.status==="success"){o.success("\u66F4\u65B0\u500B\u4EBA\u8CC7\u6599\u6210\u529F");const a={name:n.resInfo.name,avatar:n.resInfo.photo,role:n.resInfo.role,id:n.resInfo._id};t.updateUser(a),c.value=!1}}catch(l){console.log("error",l),o.success("\u66F4\u65B0\u500B\u4EBA\u8CC7\u6599\u6210\u529F\u5931\u6557"),c.value=!1}};return(l,e)=>{var n;return m(),f(j,null,[z(oe,{title:"\u4FEE\u6539\u500B\u4EBA\u8CC7\u6599"}),r("ul",de,[r("li",null,[r("a",{href:"#",class:L(["inline-block rounded-t-md border-x-2 border-t-2 border-black bg-white py-2 px-6 hover:bg-black hover:text-white",y.value==="editNickName"?"bg-black text-white":""]),onClick:e[0]||(e[0]=_(a=>F("editNickName"),["prevent"]))}," \u66B1\u7A31\u4FEE\u6539 ",2)]),r("li",null,[r("a",{href:"#",class:L(["inline-block rounded-t-md border-t-2 border-r-2 border-black bg-white py-2 px-6 hover:bg-black hover:text-white",y.value==="resetPassword"?"bg-black text-white":""]),onClick:e[1]||(e[1]=_(a=>F("resetPassword"),["prevent"]))}," \u91CD\u8A2D\u5BC6\u78BC ",2)])]),r("div",ce,[y.value==="editNickName"?(m(),f(j,{key:0},[s(d).base64?(m(),T(D,{key:0,size:"107",imgUrl:s(d).base64,class:"mb-4 rounded-full border-2 border-black"},null,8,["imgUrl"])):(m(),T(D,{key:1,size:"107",imgUrl:(n=h.value)==null?void 0:n.avatar,class:"mb-4 rounded-full border-2 border-black"},null,8,["imgUrl"])),r("form",{ref_key:"avatarForm",ref:I,action:"",class:"text-center"},[r("input",{ref_key:"imageFile",ref:N,type:"file",name:"photos",accept:"image/png, image/jpeg, image/jpg",class:"btn btn-dark mb-4 hidden px-8 py-1",onChange:e[2]||(e[2]=a=>H(a))},null,544),p(r("input",{type:"reset",value:"\u53D6\u6D88",class:"mb-4 mr-4 cursor-pointer rounded border border-black bg-white px-10 py-1 text-black",onClick:J},null,512),[[x,s(d).base64]]),r("input",{type:"button",value:s(d).base64===""?"\u4E0A\u50B3\u5927\u982D\u7167":"\u518D\u9078\u4E00\u5F35",class:"mb-4 cursor-pointer rounded border border-black bg-black px-6 py-1 text-white",onClick:e[3]||(e[3]=a=>N.value.click())},null,8,ue),s(d).hasError?(m(),f("p",me," Tip: "+k(s(d).errorMessage.size),1)):$("",!0)],512),r("form",{onSubmit:_(K,["prevent"]),action:"",class:"w-10/12 lg:w-8/12"},[r("div",pe,[we,p(r("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>h.value.name=a),type:"text",name:"",id:"nickName",placeholder:"\u8ACB\u8F38\u5165\u66B1\u7A31",class:"w-full border-2 border-black",maxlength:"10",onBlur:e[5]||(e[5]=(...a)=>s(P).name.$touch&&s(P).name.$touch(...a))},null,544),[[S,h.value.name]])]),s(P).name.$errors.length>0?(m(),f("div",fe,k(s(P).name.$errors[0].$message),1)):$("",!0),r("button",ge,[p(r("span",null,k(s(g).profile),513),[[x,!c.value]]),p(z(R,{class:"my-1 ml-1 h-4 w-4 animate-spin"},null,512),[[x,c.value]])])],40,be)],64)):(m(),f("form",{key:1,onSubmit:_(X,["prevent"]),action:"",class:"flex-col items-center w-10/12 lg:w-8/12"},[r("div",ve,[ke,p(r("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>s(u).password=a),type:"password",id:"newPassword",placeholder:"\u8ACB\u8F38\u5165\u65B0\u5BC6\u78BC",class:"w-full border-2 border-black",maxlength:"20",required:"",onBlur:e[7]||(e[7]=(...a)=>s(i).password.$touch&&s(i).password.$touch(...a))},null,544),[[S,s(u).password]])]),s(i).password.$errors.length>0?(m(),f("div",xe,k(s(i).password.$errors[0].$message),1)):$("",!0),r("div",ye,[Pe,p(r("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>s(u).confirmPassword=a),type:"password",id:"checkPassword",placeholder:"\u518D\u6B21\u8F38\u5165\u65B0\u5BC6\u78BC",class:"w-full border-2 border-black",maxlength:"20",onBlur:e[9]||(e[9]=(...a)=>s(i).confirmPassword.$touch&&s(i).confirmPassword.$touch(...a)),required:""},null,544),[[S,s(u).confirmPassword]])]),s(i).confirmPassword.$errors.length>0?(m(),f("div",_e,k(s(i).confirmPassword.$errors[0].$message),1)):$("",!0),r("button",{type:"submit",class:"mt-8 flex w-full items-center justify-center rounded border-2 border-black bg-warning py-4 text-black disabled:opacity-50",disabled:s(i).password.$errors.length>0||s(i).confirmPassword.$errors.length>0||s(u).password===void 0},[p(r("span",null,k(s(g).password),513),[[x,!c.value]]),p(z(R,{class:"my-1 ml-1 h-4 w-4 animate-spin"},null,512),[[x,c.value]])],8,$e),r("button",{ref_key:"resetvPassword",ref:A,type:"button",class:"hidden",onClick:e[10]||(e[10]=a=>s(i).$reset())}," reset ",512)],40,he))])],64)}}};export{Se as default};
